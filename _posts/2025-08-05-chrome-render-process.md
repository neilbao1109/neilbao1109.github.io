---
title: 浏览器网页渲染流程 
date: 2025-08-05 10:20:00 +0800
categories: [Chrome]
tags: [render process]
render_with_liquid: false
---



浏览器在渲染网页时会进行一系列复杂而有序的操作，这个过程通常被称为“关键渲染路径”（Critical Rendering Path）。可以将其分解为以下几个主要步骤：

### 1. 解析 (Parsing)

当你在浏览器中输入一个网址并按下回车后，浏览器首先会从服务器获取网页的HTML内容。然后，解析过程开始。

* **构建DOM树 (DOM Tree)**: 浏览器会逐行读取HTML代码，并将其解析成一个树形结构，称为“文档对象模型”（Document Object Model）。这个DOM树完整地表达了HTML文档的结构和内容。每个HTML标签（如 `<body>`, `<div>`, `<p>`）都会成为树中的一个节点（Node），标签之间的嵌套关系则构成了树的父子关系。
* **构建CSSOM树 (CSSOM Tree)**: 在解析HTML的同时，如果遇到 `<link>` 标签引用的外部CSS文件，或者 `<style>` 标签内的CSS，浏览器会开始解析CSS代码。与构建DOM树类似，浏览器会将CSS规则解析成一个树形结构，称为“CSS对象模型”（CSS Object Model）。CSSOM树表达了每个DOM节点对应的样式信息。值得注意的是，CSS的解析是**渲染阻塞**的，浏览器需要等待所有CSS都下载并解析完成，才能构建完整的CSSOM树。
* **JavaScript的执行**: 当解析器遇到 `<script>` 标签时，它会暂停HTML的解析，并开始加载、解析和执行JavaScript代码。因为JavaScript可能会修改DOM和CSSOM（例如，使用 `document.createElement()` 或 `element.style.color = 'red'`），所以浏览器需要先执行完脚本，才能继续解析剩余的HTML。这就是为什么通常建议将 `<script>` 标签放在 `<body>` 标签的末尾，以避免脚本执行阻塞页面的首次渲染。

### 2. 构建渲染树 (Render Tree Construction)

当DOM树和CSSOM树都构建完成后，浏览器会将这两者结合起来，创建一个新的树形结构，即“渲染树”（Render Tree）。

* 渲染树只包含**需要被渲染**的节点。例如，像 `<head>` 标签或设置了 `display: none;` 样式的节点，它们虽然存在于DOM树中，但不会出现在渲染树里，因为它们不需要在屏幕上显示出来。
* 渲染树上的每个节点都包含了其在DOM树中的内容和在CSSOM树中计算出的样式信息。

### 3. 布局 (Layout / Reflow)

渲染树构建完成后，浏览器进入“布局”阶段。在这个阶段，浏览器会计算出每个渲染树节点在屏幕上的**确切位置和大小**。

* 这个过程从渲染树的根节点开始，递归地遍历所有子节点。
* 浏览器会考虑视口（viewport）的大小、每个元素的盒模型（box model：margin, border, padding, content）以及元素之间的相互关系，最终输出一个包含所有元素精确几何信息的“盒子模型”。
* 这个阶段也称为“回流”（Reflow）。当页面的布局发生变化时（例如，窗口大小改变、元素尺寸或位置改变、添加或删除DOM节点），浏览器需要重新执行这个布局过程。回流是一个计算量很大的操作，频繁触发会影响性能。

### 4. 绘制 (Painting / Rasterizing)

布局阶段确定了所有元素的几何信息后，就进入了“绘制”阶段。

* **绘制 (Painting)**: 浏览器会遍历渲染树，调用每个节点的“paint”方法，将元素的内容（如文字、颜色、图片、边框、阴影等）转换成屏幕上的实际像素。绘制过程会发生在一个或多个“图层”（Layer）上。
* **栅格化 (Rasterizing)**: 为了提高效率，浏览器会将每个图层的信息转换为位图（bitmap），这个过程称为栅格化。栅格化通常由GPU（图形处理器）来加速完成，因为它非常擅长处理位图操作。

### 5. 合成 (Compositing)

一旦所有图层都被栅格化，浏览器需要将这些图层按照正确的顺序（例如，处理 `z-index` 属性）合并在一起，最终显示在屏幕上。这个过程称为“合成”。

* 使用图层和合成技术有很多好处。例如，当一个元素发生变化（如通过 `transform` 属性进行位移或旋转）而没有影响到其他图层时，浏览器只需要重新绘制并重新合成这一个图层，而不需要对整个页面进行回流和重绘，这极大地提升了渲染性能。

### 总结流程图

整个过程可以概括为：

**HTML → DOM树**
**CSS → CSSOM树**

**(DOM树 + CSSOM树) → 渲染树**

**渲染树 → 布局 (Layout)**

**布局 → 绘制 (Paint)**

**绘制 → 合成 (Composite) → 显示在屏幕上**

这个流程并不是一次性的。当用户与页面进行交互，或者JavaScript动态修改了页面内容或样式时，上述的部分或全部步骤（特别是回流和重绘）可能会被重复执行，从而实现页面的动态更新。优化前端性能的一个关键目标就是尽量减少这些重复操作的次数和开销。