---
title: SDM - Sequential Deep Matching Model for Online Large-scale Recommender System
date: 2024-03-01 10:00:00 +0800
categories: [Paper, Recommendation]
tags: [sequential]
render_with_liquid: false
math: true
---

这篇论文 **《SDM: Sequential Deep Matching Model for Online Large-scale Recommender System》**（面向在线大规模推荐系统的序列深度匹配模型）是由阿里巴巴团队（Fuyu Lv 等）发表在 **CIKM 2019** 上的经典工业界论文。

该模型主要应用于淘宝的推荐场景（如猜你喜欢），旨在解决传统协同过滤（CF）和早期深度学习模型难以捕捉**用户动态偏好**以及难以有效融合**长短期兴趣**的问题。

### 1. 核心背景与痛点 (Motivation)

在电商推荐场景中，用户的行为数据非常丰富，通常包含两类特征，但当时的模型难以同时处理好它们：

* **短期会话 (Short-term Session)**：用户当前的浏览行为（如最近点击的几个商品）。痛点在于：一个会话中用户可能表现出**多种兴趣**（比如同时在看衣服和手机），且兴趣变化极快。
* **长期行为 (Long-term Behaviors)**：用户过去几天、几周甚至几个月的历史行为。痛点在于：长期兴趣非常丰富且杂乱，如何筛选出**与当前会话相关**的长期偏好并进行有效融合是一个难题。

**SDM 试图解决的两个核心问题：**

1. **多兴趣问题**：同一个 Session 中可能存在多种兴趣倾向（例如用户在一次访问中既看了鞋子又看了数码产品），简单的 RNN 或平均池化无法有效区分。
2. **长短期融合问题**：长期偏好如果直接拼接或简单加权，容易被短期强烈的信号掩盖，或者引入长期历史中的噪声。

### 2. 模型架构详解 (Model Architecture)

SDM 的整体架构采用了经典的**双塔结构**（User Tower 和 Item Tower）用于召回（Matching）阶段。重点在于 User Tower 如何生成高质量的用户向量。

User Tower 主要包含两个核心模块：**短期兴趣建模** 和 **长期兴趣建模**，最后通过 **门控融合层** 结合。

#### A. 输入层 (Input Embedding)

* 模型不仅使用 Item ID，还引入了 **Side Information**（如类目 ID、品牌 ID、店铺 ID 等）。
* 所有特征通过 Embedding 层映射为低维向量，并进行拼接。

#### B. 短期兴趣建模 (Short-term Preference Modeling)

* **目标**：捕捉当前 Session 内的多种兴趣变化。
* **技术方案**：使用 **LSTM** + **Multi-head Self-Attention (多头自注意力机制)**。
* 首先使用 LSTM 处理序列的时序关系。
* 然后使用 **Multi-head Self-Attention**。多头机制允许模型从不同的“头”（子空间）捕捉用户在当前 Session 中的不同兴趣点（例如一个头关注“品牌”，另一个头关注“品类”）。


* **输出**：得到代表用户短期多种兴趣的向量。

#### C. 长期兴趣建模 (Long-term Preference Modeling)

* **目标**：从用户长达数天或数月的历史行为中，提取与当前短期兴趣相关的长期偏好。
* **技术方案**：使用 **User Attention (用户注意力机制)**。
* 它不是简单地处理长期序列，而是利用**用户画像 (User Profile)** 或**短期兴趣向量**作为 Query，去对长期行为序列中的 Item 进行 Attention 加权。
* 这样可以动态地“激活”长期历史中那些与当前上下文相关的商品，过滤掉无关的噪声。



#### D. 门控融合模块 (Gated Fusion Module) —— **核心创新**

* **目标**：将短期兴趣向量和长期兴趣向量融合成最终的用户向量 $v_u$。
* **技术方案**：借鉴 LSTM 的门控思想，设计了一个 **Fusion Gate**。
* 该模块输入包含：短期兴趣向量、长期兴趣向量、以及用户画像 Embedding。
* 通过学习一个门控系数 $\alpha$（0到1之间），来决定当前推荐应该更偏重短期兴趣（如即时购买需求）还是长期兴趣（如固有风格偏好）。
* 公式逻辑类似于：
$$
Output = \left(1-\alpha\right)\cdot Short + \alpha\cdot Long
$$



### 3. 核心创新点 (Key Contributions)

1. **显式区分长短期兴趣**：将用户行为序列明确切分为“当前 Session”和“历史行为”，并设计不同的网络结构分别建模。
2. **Multi-head Attention 捕捉短期多兴趣**：在 Session 建模中引入 Transformer 的核心组件，有效解决了单次访问中意图不单一的问题。
3. **门控融合 (Gated Fusion)**：相比于传统的 Concat（拼接）或 Sum（求和），门控机制能更智能地在“探索新兴趣”和“坚持旧偏好”之间做权衡。

### 4. 实验与落地 (Experiments & Impact)

* **离线效果**：在淘宝数据集和京东数据集上，SDM 相比于 Youtube DNN、DIN 等基线模型，在 Recall（召回率）等指标上有显著提升。
* **在线效果**：在淘宝的大规模召回系统中上线，显著提升了 CTR（点击率）和 GMV（成交总额）。
* **工程价值**：该模型是针对大规模工业级数据的（Large-scale），在设计上考虑了计算效率，适合作为**召回层（Matching Stage）**的模型，为后续的精排层提供高质量的候选集。

### 5. 总结

SDM 是序列推荐领域（Sequential Recommendation）中**长短期兴趣融合**的一个范式之作。

* **对于学术界**：它证明了 Attention 机制在处理序列噪声和多兴趣建模上的有效性。
* **对于工业界**：它提供了一套标准的“双塔召回 + 长短期序列建模”的落地方案，后续许多大厂的序列召回模型（如阿里的 MIND、ComiRec 等）都在此基础上进一步强化了对“多兴趣（Multi-Interest）”的显式提取（即输出多个用户向量，而 SDM 最终融合为了一个向量）。